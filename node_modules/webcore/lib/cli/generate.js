var path = require('path'),
	fs = require('fs'),
	term = require('./term'),
	generators = {};

fs.readdirSync(__dirname + '/generators').forEach(function(filename) {
	if (!filename.match(/\.js$/i)) { return; }

	var name = path.basename(filename, '.js');
	generators.__defineGetter__(name, function() {
		return require('./generators/' + name);
	});
});

module.exports = function generate(name, option) {
	var generator = generators[name],
		pkg = require(path.resolve('./package.json')),
		version = pkg.webcore && pkg.webcore.version;

	if (!version) {
		term.log();
		return term.exit(new Error('FATAL: Not a webcore project. Cannot continue.'));
	}

	if (!generator) {
		term.log();
		return term.exit(new Error('FATAL: No generator defined for ' + name));
	}

	generator.generate(option);
};
