var util = require('util'),
	dust = require('dustjs-linkedin'),
	Compiler = require('./compiler');

/**
 * Dust Compiling File Processor
 */
var DustCompiler = module.exports = function(src, dest, next) {
	Compiler.apply(this, [src, dest, /(\.dust)$/ig, '.js', next]);
};

util.inherits(DustCompiler, Compiler);

DustCompiler.prototype._compile = function(name, content, callback) {
	try {
		// Remove local path location prefix and ensure path separators are correct (/)
		var templateName = name.replace(/.*templates[^\w]*/i, '');
		templateName = templateName.replace(/\\/g, '/');
		callback(null, dust.compile(content, templateName));
	} catch (err) {
		callback(err);
	}
};
