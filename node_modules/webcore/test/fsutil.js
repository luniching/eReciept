var fs = require('fs'),
	should = require('should'),
	path = require('path'),
	fsutil = require('../lib/fsutil.js'),
	exists = fs.exists || path.exists;

describe('fsutil', function() {

	it('should make a directory', function(done) {
		fsutil.mkdir('./tmp', function(err) {
			if (err) { return done(err); }
			exists('./tmp', function(exists) {
				exists.should.equal(true);
				fs.writeFile('./tmp/test.txt', 'This is a test file.', done);
			});
		});
	});


	it('should make another directory', function(done) {
		fsutil.mkdir('./tmp/tmp2', function(err) {
			if (err) { return done(err); }
			exists('./tmp/tmp2', function(exists) {
				exists.should.equal(true);
				done();
			});
		});
	});


	it('should copy a file', function(done) {
		fsutil.copy('./tmp/test.txt', './tmp/tmp2/test.txt', function(err) {
			if (err) { return done(err); }
			fs.stat('./tmp/tmp2/test.txt', function(err, stats) {
				done(err);
			});
		});
	});


	it('should copy the contents of one directory into another', function(done) {
		fsutil.copydir('./tmp', './tmp-copy', function(err) {
			if (err) { return done(err); }
			fs.stat('./tmp-copy/test.txt', function(err, stats) {
				fs.unlink('./tmp-copy/tmp2/test.txt', done);
			});
		});
	});


	it('should correctly report a non-empty directory as not empty', function(done) {
		fsutil.isempty('./tmp-copy', function(err, empty) {
			if (err) { return done(err); }
			false.should.equal(empty);
			done();
		});
	});

	it('should correctly report a non-empty directory as not empty, synchronously', function(done) {
		var empty = fsutil.isemptySync('./tmp-copy');
		false.should.equal(empty);
		done();
	});

	it('should correctly report an empty directory as empty', function(done) {
		fsutil.isempty('./tmp-copy/tmp2', function(err, empty) {
			if (err) { return done(err); }
			true.should.equal(empty);
			done();
		});
	});


	it('should delete an empty directory', function(done) {
		fsutil.rmdirf('./tmp-copy/tmp2', done);
	});


	it('should delete a directory that is not empty', function(done) {
		fsutil.rmdirf('./tmp', function(err) {
			if (err) { return done(err); }
			fsutil.rmdirf('./tmp-copy', done);
		});
	});

});
